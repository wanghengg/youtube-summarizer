<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YouTube 字幕总结助手</title>
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <div class="container">
    <header class="header">
      <h1>📺 YouTube 字幕总结</h1>
    </header>

    <!-- 主页面 -->
    <div id="main-view" class="view active">
      <div id="video-info" class="video-info hidden">
        <div class="video-title" id="video-title"></div>
        <div class="video-author" id="video-author"></div>
      </div>

      <div id="status-area" class="status-area">
        <div class="status-message" id="status-message">
          正在检查页面...
        </div>
      </div>

      <div id="action-area" class="action-area">
        <button id="extract-btn" class="btn btn-primary" disabled>
          🎬 提取字幕并总结
        </button>
        <button id="settings-btn" class="btn btn-secondary">
          ⚙️ 设置
        </button>
      </div>

      <div id="progress-area" class="progress-area hidden">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">准备中...</div>
      </div>

      <div id="result-area" class="result-area hidden">
        <div class="result-header">
          <h3>📋 总结结果</h3>
          <button id="copy-btn" class="btn btn-small">📋 复制</button>
        </div>
        <div class="result-content" id="result-content"></div>
        <div class="subtitle-info" id="subtitle-info"></div>
      </div>

      <div id="error-area" class="error-area hidden">
        <div class="error-message" id="error-message"></div>
        <button id="retry-btn" class="btn btn-secondary">🔄 重试</button>
      </div>

      <!-- 无字幕时的语音识别选项 -->
      <div id="no-subtitle-area" class="no-subtitle-area hidden">
        <div class="warning-message">
          ⚠️ 该视频没有可用的字幕
        </div>
        <p>您可以选择使用语音识别来获取内容：</p>
        <div class="audio-options">
          <label>
            识别时长：
            <select id="audio-duration">
              <option value="30">30 秒</option>
              <option value="60" selected>1 分钟</option>
              <option value="120">2 分钟</option>
              <option value="180">3 分钟</option>
            </select>
          </label>
          <label id="speech-language-label">
            识别语言：
            <select id="speech-language">
              <option value="zh-CN">中文（简体）</option>
              <option value="zh-TW">中文（繁体）</option>
              <option value="en-US">English (US)</option>
              <option value="en-GB">English (UK)</option>
              <option value="ja-JP">日本語</option>
              <option value="ko-KR">한국어</option>
            </select>
          </label>
        </div>
        <button id="start-audio-btn" class="btn btn-primary">
          🎤 开始语音识别
        </button>
        <p class="note" id="speech-note">注意：语音识别需要视频正在播放</p>
      </div>
    </div>

    <!-- 设置页面 -->
    <div id="settings-view" class="view">
      <div class="settings-header">
        <button id="back-btn" class="btn btn-icon">← 返回</button>
        <h2>⚙️ 设置</h2>
      </div>

      <div class="settings-form">
        <div class="form-group">
          <label for="api-provider">API 提供商</label>
          <select id="api-provider">
            <option value="openai">OpenAI</option>
            <option value="anthropic">Anthropic (Claude)</option>
            <option value="deepseek">DeepSeek</option>
            <option value="qwen">通义千问 (Qwen)</option>
            <option value="glm">智谱 GLM</option>
            <option value="kimi">Kimi (月之暗面)</option>
            <option value="custom">自定义</option>
          </select>
        </div>

        <div class="form-group">
          <label for="api-key">API Key</label>
          <input type="password" id="api-key" placeholder="输入您的 API Key">
          <button id="toggle-key" class="btn btn-icon">👁️</button>
        </div>

        <div class="form-group" id="endpoint-group">
          <label for="api-endpoint">API Endpoint</label>
          <input type="text" id="api-endpoint" placeholder="https://api.openai.com/v1/chat/completions">
        </div>

        <div class="form-group">
          <label for="model">模型</label>
          <select id="model">
            <!-- 模型选项将由 JavaScript 动态填充 -->
          </select>
          <input type="text" id="custom-model" class="hidden" placeholder="输入自定义模型名称">
        </div>

        <div class="form-group">
          <label for="speech-recognition-provider">语音识别方式</label>
          <select id="speech-recognition-provider">
            <option value="webspeech">Web Speech API (免费)</option>
            <option value="whisper">OpenAI Whisper (付费)</option>
          </select>
          <p class="form-hint">Web Speech API 由 Chrome 浏览器提供，完全免费；Whisper 需要 OpenAI API Key</p>
        </div>

        <div id="whisper-settings" class="whisper-settings hidden">
          <div class="form-group">
            <label for="whisper-endpoint">Whisper API Endpoint</label>
            <input type="text" id="whisper-endpoint" placeholder="https://api.openai.com/v1/audio/transcriptions">
          </div>

          <div class="form-group">
            <label for="whisper-model">Whisper 模型</label>
            <select id="whisper-model">
              <option value="whisper-1">Whisper-1</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button id="save-settings" class="btn btn-primary">💾 保存设置</button>
          <button id="test-api" class="btn btn-secondary">🔍 测试连接</button>
        </div>

        <div id="settings-status" class="settings-status hidden"></div>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>

</html>